import{_ as G}from"./AlertDialog-BL-sqSwc.js";import{ay as I,H as J,r as i,G as L,c as k,f as l,b as g,m as o,e as r,a3 as M,o as s,ax as U,l as z,t as u,v as c,d as t,F as h,h as E,a1 as F}from"./main-BmaFLECC.js";import{u as H}from"./useApi-aDZ_p2JA.js";import{c as K}from"./createUrl-CavU1t8i.js";import{d as m,a as w}from"./mixins-C1PpnV79.js";import{$ as A}from"./api-CmLymv6O.js";import{V as T}from"./VCard-DPBtMZW7.js";import{V as P}from"./VCardText-D2uK2Y8d.js";import{V as D}from"./VAlert-BxLHTpLf.js";import{V as W}from"./VTable-BeAEwmxm.js";import{V}from"./VChip-DASL0bCx.js";import"./VDialog-DE__mQip.js";import"./VOverlay-DrobohEp.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-60m1FPF8.js";import"./index-9rIf2CJL.js";import"./VAvatar-DzKqRnSB.js";const O={class:"text-center"},Q={class:"text-center"},X={class:"text-center"},Y={class:"text-center"},Z={class:"text-center"},ve={__name:"dapodik",setup(ee){I({title:`Ambil Data Dapodik | ${J.app.title}`});const b=i(!0),S=i(!1),$=i([]),v=i(),f=i(!1),_=i({color:"",title:"",text:""}),B=async()=>{try{let e=(await H(K("/sinkronisasi",{query:{sekolah_id:m.sekolah_id,semester_id:w.semester_id,user_id:m.user_id}}))).data.value;S.value=e.jam_sinkron,$.value=e.data_sinkron,v.value=e.error}catch(n){console.error(n)}finally{b.value=!1}},j=n=>n.dapodik>n.erapor,y=i(!1),x=i(!1),d=i(),N=async()=>{await A(`/sinkronisasi/hitung/${m.sekolah_id}`,{method:"GET",onResponse({request:n,response:e,options:p}){let a=e._data;a.output&&(a.output.jumlah?a.output.jumlah===1&&a.output.inserted===1?d.value="Proses sinkronisasi selesai":d.value=`${a.output.table} (${a.output.inserted}/${a.output.jumlah})`:d.value=a.output.table)}})},R=async(n,e)=>{if(console.log(n),console.log(e),n&&e){x.value=!0,d.value="Menyiapkan proses sinkronisasi",y.value=!0;var p;p=setInterval(N,500),await A("/sinkronisasi/dapodik",{method:"POST",body:{email:m.email,satuan:e,tujuan:n,sekolah_id:m.sekolah_id,semester_id:w.semester_id,user_id:m.user_id},onResponse({request:a,response:C,options:ae}){C._data,y.value=!1,x.value=!1,clearInterval(p),d.value="Proses sinkronisasi selesai",f.value=!0,_.value={color:"success",title:"Berhasil",text:"Sinkronisasi Dapodik Berhasil"}}})}};L(async()=>{await B()});const q=()=>{B()};return(n,e)=>{const p=G;return s(),k("div",null,[o(b)?(s(),l(T,{key:0,class:"text-center mb-10"},{default:r(()=>[g(U,{size:60,indeterminate:"",color:"error",class:"my-10"})]),_:1})):(s(),l(T,{key:1},{default:r(()=>[o(x)?(s(),l(P,{key:0},{default:r(()=>[g(D,{color:"secondary",class:"text-center"},{default:r(()=>[u(c(o(d)),1)]),_:1})]),_:1})):z("",!0),g(P,null,{default:r(()=>[o(S)?(s(),l(D,{key:0,color:"error",class:"text-center",variant:"tonal"},{default:r(()=>e[1]||(e[1]=[t("h2",{class:"mt-4 mb-4"},"Penyesuaian Waktu Layanan Sinkronisasi Dapodik",-1),t("p",null,[u("Dikarenakan adanya proses rutin sinkronisasi data Dapodik antara Server PUSDATIN dan Server Direktorat SMK, "),t("br"),u("maka layanan sinkronisasi hanya dapat diakses antara pukul "),t("span",{class:"text-danger"},[t("b",null,"03.00 s/d 24.00 (WIB)")])],-1)])),_:1})):o(v)?(s(),l(D,{key:1,title:"Pengambilan Dapodik Gagal",type:"error",variant:"tonal"},{default:r(()=>[u(" Status Server: "+c(o(v).message),1)]),_:1})):(s(),l(W,{key:2,class:"text-no-wrap"},{default:r(()=>[e[6]||(e[6]=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"Data"),t("th",{class:"text-center"},"Jml Dapodik"),t("th",{class:"text-center"},"Jml e-Rapor"),t("th",{class:"text-center"},"Jml Sinkron"),t("th",{class:"text-center"},"Status"),t("th",{class:"text-center"},"Aksi")])],-1)),t("tbody",null,[(s(!0),k(h,null,E(o($),a=>(s(),k("tr",{key:a.nama},[t("td",null,c(a.nama),1),t("td",O,c(a.dapodik),1),t("td",Q,c(a.erapor),1),t("td",X,c(a.sinkron),1),t("td",Y,[a.sinkron?(s(),k(h,{key:0},[j(a)?(s(),l(V,{key:0,color:"warning"},{default:r(()=>e[2]||(e[2]=[u("Kurang")])),_:1})):(s(),l(V,{key:1,color:"success"},{default:r(()=>e[3]||(e[3]=[u("Lengkap")])),_:1}))],64)):(s(),l(V,{key:1,color:"error"},{default:r(()=>e[4]||(e[4]=[u("Belum")])),_:1}))]),t("td",Z,[a.dapodik?(s(),l(F,{key:0,loading:o(y),disabled:o(y),size:"small",color:"success",onClick:C=>R(a.server,a.aksi)},{default:r(()=>e[5]||(e[5]=[u(" Sinkronisasi ")])),_:2},1032,["loading","disabled","onClick"])):(s(),k(h,{key:1},[u(" - ")],64))])]))),128))])]),_:1}))]),_:1})]),_:1})),g(p,{isDialogVisible:o(f),"onUpdate:isDialogVisible":e[0]||(e[0]=a=>M(f)?f.value=a:null),"confirm-color":o(_).color,"confirm-title":o(_).title,"confirm-msg":o(_).text,onConfirm:q},null,8,["isDialogVisible","confirm-color","confirm-title","confirm-msg"])])}}};export{ve as default};
