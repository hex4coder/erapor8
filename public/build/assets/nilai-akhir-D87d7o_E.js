import{a as le,d as R,e as te,f as ne}from"./mixins-svkIUe8t.js";import{r as u,f as U,e as i,o as _,b as l,t as A,m as e,a2 as k,d as s,aa as K,y as N,c as j,am as ie,h as M,F as E,ao as oe,v as q}from"./main-BpmJh41A.js";import{_ as re}from"./ConfirmDialog-CVzj8GxL.js";import{_ as se}from"./AppTextField-DGiiipqE.js";import{_ as me}from"./ProfileSiswa-Bw4pWjQB.js";import{_ as ue}from"./AppSelect-x72rs1jw.js";import{_ as de}from"./DefaultForm-CFMYbHt-.js";import{$ as z}from"./api-QfHleiH2.js";import{V as pe,c as fe,a as _e,b as L}from"./VCard-B9G_vGWu.js";import{V as I}from"./VDivider-CmhbY4f5.js";import{V as $,a as c}from"./VRow-sVjJTxRE.js";import{V as be}from"./VFileInput-CcLALRba.js";import{V as ce}from"./VTable-YLYZarsg.js";import{V as ge}from"./VForm-qBbp11Yt.js";import"./VDialog-B7f4eoKY.js";import"./VOverlay-C3QPzXLV.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-Df_9CN7p.js";import"./VLabel-ButeU4cC.js";import"./VAvatar-BY-YdZ5b.js";import"./VList-BD9tx2Gq.js";import"./VMenu-4zAydqwT.js";import"./VSelectionControl-BeMFLjf6.js";import"./VChip-BucnKRkR.js";import"./AppAutocomplete-CY9IYvdd.js";import"./filter-BvaM9xFg.js";import"./index-BxkgbwWS.js";/* empty css              */const ke={key:0,class:"text-center"},ve=["rowspan"],Ve=["rowspan"],xe=["rowspan"],ye={style:{"inline-size":"6rem"}},Ze={__name:"nilai-akhir",setup(he){const S=u(""),o=u({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null}),p=u({akhir:{},kompeten:{}}),g=u({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null}),r=u({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),m=u({rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1}),w=u(!1),v=u(!1),T=u(!1),V=u(!1),O=u(""),x=u({color:"",title:"",text:""}),G=async()=>{v.value=!0;const n={...C,...o.value,...p.value};await z("/penilaian/simpan",{method:"POST",body:n,onResponse({response:a}){let f=a._data;v.value=!1,f.errors?g.value=f.errors:(V.value=!0,x.value=f)}})},C={opsi:"nilai-akhir",semester_id:le.semester_id,user_id:R.user_id,guru_id:R.guru_id,sekolah_id:R.sekolah_id,merdeka:!1},D=u(!1),H=()=>{D.value=!0,o.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,bentuk_penilaian:null,template_excel:null},p.value={akhir:{},kompeten:{}},g.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,bentuk_penilaian:null,template_excel:null},r.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},m.value={rombel:!1,mapel:!1,bentuk_penilaian:!1,body:!1},w.value=!1,v.value=!1,T.value=!1,V.value=!1,O.value="",x.value={color:"",title:"",text:""}},B=async n=>{const a={...n,...C};await z("/referensi/get-data",{method:"POST",body:a,onResponse({response:f}){let d=f._data;n.data=="rombel"&&(r.value.rombel=d),n.data=="mapel"&&(r.value.mapel=d.mapel,C.merdeka=d.merdeka),n.data=="teknik"&&(r.value.teknik=d)}})},J=async n=>{o.value.rombongan_belajar_id=null,o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,n&&(m.value.rombel=!0,await B({data:"rombel",nilai:1,tingkat:n}).then(()=>{m.value.rombel=!1}))},Q=async n=>{o.value.pembelajaran_id=null,o.value.mata_pelajaran_id=null,n&&(m.value.mapel=!0,await B({data:"mapel",nilai:1,rombongan_belajar_id:n}).then(()=>{m.value.mapel=!1}))},W=async n=>{o.value.bentuk_penilaian=null,n&&(m.value.bentuk_penilaian=!0,await B({data:"teknik"}).then(()=>{m.value.bentuk_penilaian=!1}))},F=u(!1),X=async n=>{if(r.value.siswa=[],r.value.tp=[],n){const a={...o.value,...C};m.value.body=!0,w.value=!1,await z("/penilaian/get-nilai-akhir",{method:"POST",body:a,onResponse({response:f}){let d=f._data;r.value.siswa=d.data_siswa,r.value.tp=d.data_tp,S.value="",o.value.bentuk_penilaian=="asesmen"?F.value=!0:(F.value=!1,S.value=`/downloads/template-nilai-akhir/${o.value.pembelajaran_id}`),d.data_siswa.forEach(b=>{o.value.bentuk_penilaian=="asesmen"?p.value.akhir[b.anggota_rombel_id]=b.nilai_asesmen:p.value.akhir[b.anggota_rombel_id]=b.nilai_akhir,d.data_tp.forEach(P=>{const y=b.capaian_kompeten.find(t=>t.tp_id===P.tp_id);p.value.kompeten[b.anggota_rombel_id+"#"+P.tp_id]=y==null?void 0:y.kompeten})}),w.value=!0,m.value.body=!1}})}},Y=()=>{H()},Z=async n=>{console.log(n),o.value.template_excel=null};return(n,a)=>{const f=de,d=ue,b=me,P=se,y=re;return _(),U(pe,{class:"mb-6"},{default:i(()=>[l(_e,{class:"pb-4"},{default:i(()=>[l(fe,null,{default:i(()=>a[9]||(a[9]=[A("Input Nilai Akhir")])),_:1})]),_:1}),l(I),l(ge,{onSubmit:oe(G,["prevent"])},{default:i(()=>[l(L,null,{default:i(()=>[l($,null,{default:i(()=>[l(f,{form:e(o),"onUpdate:form":a[0]||(a[0]=t=>k(o)?o.value=t:null),errors:e(g),"onUpdate:errors":a[1]||(a[1]=t=>k(g)?g.value=t:null),arrayData:e(r),"onUpdate:arrayData":a[2]||(a[2]=t=>k(r)?r.value=t:null),loading:e(m),"onUpdate:loading":a[3]||(a[3]=t=>k(m)?m.value=t:null),resetForm:e(D),"onUpdate:resetForm":a[4]||(a[4]=t=>k(D)?D.value=t:null),onTingkat:J,onRombongan_belajar_id:Q,onPembelajaran_id:W},null,8,["form","errors","arrayData","loading","resetForm"]),l(c,{cols:"12"},{default:i(()=>[l($,{"no-gutters":""},{default:i(()=>[l(c,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:i(()=>a[10]||(a[10]=[s("label",{class:"v-label text-body-2 text-high-emphasis",for:"bentuk_penilaian"},"Bentuk Penilaian",-1)])),_:1}),l(c,{cols:"12",md:"9"},{default:i(()=>[l(d,{modelValue:e(o).bentuk_penilaian,"onUpdate:modelValue":[a[5]||(a[5]=t=>e(o).bentuk_penilaian=t),X],placeholder:"== Pilih Bentuk Penilaian ==",items:"bentukPenilaian"in n?n.bentukPenilaian:e(te),clearable:"","clear-icon":"tabler-x","error-messages":e(g).bentuk_penilaian,loading:e(m).bentuk_penilaian,disabled:e(m).bentuk_penilaian},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),e(r).siswa.length&&!e(F)?(_(),U(c,{key:0,cols:"12"},{default:i(()=>[l($,{"no-gutters":""},{default:i(()=>[l(c,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:i(()=>a[11]||(a[11]=[s("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(c,{cols:"12",md:"9"},{default:i(()=>[l($,{"no-gutters":""},{default:i(()=>[l(c,{cols:"6"},{default:i(()=>[l(be,{id:"template_excel",modelValue:e(o).template_excel,"onUpdate:modelValue":[a[6]||(a[6]=t=>e(o).template_excel=t),Z],"error-messages":e(g).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"6"},{default:i(()=>[l(K,{color:"primary",class:"ms-3",href:e(S),target:"_blank"},{default:i(()=>a[12]||(a[12]=[A(" Unduh Template Nilai Akhir ")])),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):N("",!0)]),_:1}),e(m).body?(_(),j("div",ke,[l(ie,{size:60,indeterminate:"",color:"error",class:"my-10"})])):N("",!0)]),_:1}),l(I),e(r).siswa.length?(_(),U(ce,{key:0},{default:i(()=>[a[13]||(a[13]=s("thead",null,[s("tr",null,[s("th",{class:"text-center"},"No."),s("th",{class:"text-center"},"Nama Peserta Didik"),s("th",{class:"text-center"},"Nilai Akhir"),s("th",{class:"text-center"},"Ketercapaian Kompetensi"),s("th",null,"Deskripsi Tujuan Pembelajaran")])],-1)),s("tbody",null,[(_(!0),j(E,null,M(e(r).siswa,(t,ee)=>(_(),j(E,null,[s("tr",null,[s("td",{class:"text-center pt-2",rowspan:e(r).tp.length+1,style:{"vertical-align":"top"}},q(ee+1),9,ve),s("td",{rowspan:e(r).tp.length+1,class:"text-no-wrap pt-2",style:{"vertical-align":"top"}},[l(b,{item:t},null,8,["item"])],8,Ve),s("td",{rowspan:e(r).tp.length+1,style:{"vertical-align":"top"},class:"pt-2"},[s("div",ye,[l(P,{type:"number",modelValue:e(p).akhir[t.anggota_rombel_id],"onUpdate:modelValue":h=>e(p).akhir[t.anggota_rombel_id]=h,disabled:e(F)},null,8,["modelValue","onUpdate:modelValue","disabled"])])],8,xe)]),(_(!0),j(E,null,M(e(r).tp,(h,je)=>(_(),j("tr",null,[s("td",null,[l(d,{modelValue:e(p).kompeten[t.anggota_rombel_id+"#"+h.tp_id],"onUpdate:modelValue":ae=>e(p).kompeten[t.anggota_rombel_id+"#"+h.tp_id]=ae,placeholder:"== Pilih Capaian ==",items:"dataCapaian"in n?n.dataCapaian:e(ne),clearable:"","clear-icon":"tabler-x",style:{"inline-size":"12rem"}},null,8,["modelValue","onUpdate:modelValue","items"])]),s("td",null,q(h.deskripsi),1)]))),256))],64))),256))])]),_:1})):N("",!0),l(I),e(w)?(_(),U(L,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:i(()=>[l(K,{variant:"elevated",type:"submit",loading:e(v),disabled:e(v)},{default:i(()=>a[14]||(a[14]=[A(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):N("",!0)]),_:1}),l(y,{isDialogVisible:e(T),"onUpdate:isDialogVisible":a[7]||(a[7]=t=>k(T)?T.value=t:null),isNotifVisible:e(V),"onUpdate:isNotifVisible":a[8]||(a[8]=t=>k(V)?V.value=t:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":e(O),"confirm-color":e(x).color,"confirm-title":e(x).title,"confirm-msg":e(x).text,onClose:Y},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"])]),_:1})}}};export{Ze as default};
