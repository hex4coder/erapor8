import{_ as re}from"./ConfirmDialog-CVzj8GxL.js";import{_ as se}from"./AppTextField-DGiiipqE.js";import{_ as me}from"./ProfileSiswa-Bw4pWjQB.js";import{_ as ue}from"./AppSelect-x72rs1jw.js";import{_ as de}from"./DefaultForm-CFMYbHt-.js";import{r as d,f as U,e as o,a as pe,o as g,b as l,t as V,m as a,a2 as x,d as u,aa as K,v as N,y as w,c,am as _e,h as M,F as $,ao as fe}from"./main-BpmJh41A.js";import{$ as O}from"./api-QfHleiH2.js";import{a as ge,d as z}from"./mixins-svkIUe8t.js";import{V as be,c as ce,a as ve,b as Q}from"./VCard-B9G_vGWu.js";import{V as J}from"./VDivider-CmhbY4f5.js";import{V as P,a as v}from"./VRow-sVjJTxRE.js";import{V as ke}from"./VFileInput-CcLALRba.js";import{V as Ve}from"./VAlert-C8bA4mWZ.js";import{V as xe}from"./VTable-YLYZarsg.js";import{V as ye}from"./VForm-qBbp11Yt.js";import{V as je}from"./VTooltip-DM_dqrba.js";import"./VDialog-B7f4eoKY.js";import"./VOverlay-C3QPzXLV.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-Df_9CN7p.js";import"./VLabel-ButeU4cC.js";import"./VAvatar-BY-YdZ5b.js";import"./VList-BD9tx2Gq.js";import"./VMenu-4zAydqwT.js";import"./VSelectionControl-BeMFLjf6.js";import"./VChip-BucnKRkR.js";import"./AppAutocomplete-CY9IYvdd.js";import"./filter-BvaM9xFg.js";import"./index-BxkgbwWS.js";/* empty css              */const Te={key:0,class:"text-center"},he={class:"text-center"},Ue={class:"text-center"},we={style:{"inline-size":"4rem"}},ia={__name:"asesmen-sumatif",setup($e){const R=d(""),L=d(""),i=d({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),p=d({tp:{},sumatif:{}}),k=d({tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null}),m=d({rombel:[],mapel:[],teknik:[],siswa:[],tp:[]}),_=d({rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1}),C=d(!1),j=d(!1),F=d(!1),T=d(!1),q=d(""),h=d({color:"",title:"",text:""}),W=async()=>{j.value=!0;const n={...y,...i.value,...p.value};await O("/penilaian/simpan",{method:"POST",body:n,onResponse({response:e}){let r=e._data;j.value=!1,r.errors?k.value=r.errors:(T.value=!0,h.value=r)}})},y={opsi:"",semester_id:ge.semester_id,user_id:z.user_id,guru_id:z.guru_id,sekolah_id:z.sekolah_id},S=d(!1),X=()=>{S.value=!0,i.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,mata_pelajaran_id:null,teknik_penilaian_id:null,template_excel:null},p.value={tp:{},sumatif:{}},k.value={tingkat:null,rombongan_belajar_id:null,pembelajaran_id:null,teknik_penilaian_id:null,template_excel:null},m.value={rombel:[],mapel:[],teknik:[],siswa:[],tp:[]},_.value={rombel:!1,mapel:!1,teknik_penilaian_id:!1,body:!1},C.value=!1,j.value=!1,F.value=!1,T.value=!1,q.value="",h.value={color:"",title:"",text:""},y.opsi=""},E=async n=>{const e={...n,...y};await O("/referensi/get-data",{method:"POST",body:e,onResponse({response:r}){let s=r._data;n.data=="rombel"&&(m.value.rombel=s),n.data=="mapel"&&(m.value.mapel=s.mapel),n.data=="teknik"&&(m.value.teknik=s)}})},Y=async n=>{i.value.rombongan_belajar_id=null,i.value.pembelajaran_id=null,i.value.mata_pelajaran_id=null,n&&(_.value.rombel=!0,await E({data:"rombel",nilai:1,tingkat:n}).then(()=>{_.value.rombel=!1}))},Z=async n=>{i.value.pembelajaran_id=null,i.value.mata_pelajaran_id=null,n&&(_.value.mapel=!0,await E({data:"mapel",nilai:1,rombongan_belajar_id:n}).then(()=>{_.value.mapel=!1}))},ee=async n=>{i.value.teknik_penilaian_id=null,n&&(_.value.teknik_penilaian_id=!0,await E({data:"teknik"}).then(()=>{_.value.teknik_penilaian_id=!1}))},B=d(!1),D=d(!1),ae=async n=>{m.value.siswa=[],m.value.tp=[],n&&(_.value.body=!0,await O("/penilaian/get-cp",{method:"POST",body:{rombongan_belajar_id:i.value.rombongan_belajar_id,pembelajaran_id:i.value.pembelajaran_id,mata_pelajaran_id:i.value.mata_pelajaran_id,teknik_penilaian_id:i.value.teknik_penilaian_id},onResponse({response:e}){let r=e._data;D.value=r.show_cp,m.value.siswa=r.data_siswa,m.value.tp=r.data_tp,B.value=!1,C.value=!1,r.show_cp&&!r.data_tp.length&&(B.value=!0),m.value.siswa.length&&(C.value=!0),m.value.siswa.forEach(s=>{D.value?(R.value="Sumatif Lingkup Materi",y.opsi="nilai-tp",s.anggota_rombel.nilai_tp.length&&s.anggota_rombel.nilai_tp.forEach(f=>{p.value.tp[s.anggota_rombel.anggota_rombel_id+"#"+f.tp_id]=f.nilai})):(R.value="Sumatif Akhir Semester",y.opsi="nilai-sumatif",s.anggota_rombel.nilai_sumatif.length&&s.anggota_rombel.nilai_sumatif.forEach(f=>{p.value.sumatif[s.anggota_rombel.anggota_rombel_id+"#"+f.jenis]=f.nilai}))}),L.value=`/downloads/template-${y.opsi}/${i.value.pembelajaran_id}`,_.value.body=!1}}))},le=()=>{X()},te=n=>{var e=0,r=0;n.forEach(function(f,H){e+=f,r++});var s=e/r;return s.toFixed(0)},G=(n,e)=>{var r=0,s=p.value.sumatif[`${n}#non-tes`],f=p.value.sumatif[`${n}#tes`];s&&f?r=te([parseInt(s),parseInt(f)]):s&&!f?r=s:!s&&f&&(r=f),p.value.sumatif[`${n}#na`]=r},ne=async n=>{console.log(n),i.value.template_excel=null};return(n,e)=>{const r=de,s=ue,f=pe("router-link"),H=me,A=se,oe=re;return g(),U(be,{class:"mb-6"},{default:o(()=>[l(ve,{class:"pb-4"},{default:o(()=>[l(ce,null,{default:o(()=>e[9]||(e[9]=[V("Input Asesmen")])),_:1})]),_:1}),l(J),l(ye,{onSubmit:fe(W,["prevent"])},{default:o(()=>[l(Q,null,{default:o(()=>[l(P,null,{default:o(()=>[l(r,{form:a(i),"onUpdate:form":e[0]||(e[0]=t=>x(i)?i.value=t:null),errors:a(k),"onUpdate:errors":e[1]||(e[1]=t=>x(k)?k.value=t:null),arrayData:a(m),"onUpdate:arrayData":e[2]||(e[2]=t=>x(m)?m.value=t:null),loading:a(_),"onUpdate:loading":e[3]||(e[3]=t=>x(_)?_.value=t:null),resetForm:a(S),"onUpdate:resetForm":e[4]||(e[4]=t=>x(S)?S.value=t:null),onTingkat:Y,onRombongan_belajar_id:Z,onPembelajaran_id:ee},null,8,["form","errors","arrayData","loading","resetForm"]),l(v,{cols:"12"},{default:o(()=>[l(P,{"no-gutters":""},{default:o(()=>[l(v,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[10]||(e[10]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"teknik_penilaian_id"},"Jenis Asesmen",-1)])),_:1}),l(v,{cols:"12",md:"9"},{default:o(()=>[l(s,{modelValue:a(i).teknik_penilaian_id,"onUpdate:modelValue":[e[5]||(e[5]=t=>a(i).teknik_penilaian_id=t),ae],placeholder:"== Pilih Jenis Asesmen ==",items:a(m).teknik,clearable:"","clear-icon":"tabler-x","item-value":"teknik_penilaian_id","item-title":"nama","error-messages":a(k).teknik_penilaian_id,loading:a(_).teknik_penilaian_id,disabled:a(_).teknik_penilaian_id},null,8,["modelValue","items","error-messages","loading","disabled"])]),_:1})]),_:1})]),_:1}),a(m).siswa.length?(g(),U(v,{key:0,cols:"12"},{default:o(()=>[l(P,{"no-gutters":""},{default:o(()=>[l(v,{cols:"12",md:"3",class:"d-flex align-items-center"},{default:o(()=>e[11]||(e[11]=[u("label",{class:"v-label text-body-2 text-high-emphasis",for:"template_excel"},"Template Excel",-1)])),_:1}),l(v,{cols:"12",md:"9"},{default:o(()=>[l(P,{"no-gutters":""},{default:o(()=>[l(v,{cols:"6"},{default:o(()=>[l(ke,{id:"template_excel",modelValue:a(i).template_excel,"onUpdate:modelValue":[e[6]||(e[6]=t=>a(i).template_excel=t),ne],"error-messages":a(k).template_excel,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",label:"Unggah Template Excel"},null,8,["modelValue","error-messages"])]),_:1}),l(v,{cols:"6"},{default:o(()=>[l(K,{color:"primary",class:"ms-3",href:a(L),target:"_blank"},{default:o(()=>[V(" Unduh Template "+N(a(R)),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1}),a(_).body?(g(),c("div",Te,[l(_e,{size:60,indeterminate:"",color:"error",class:"my-10"})])):w("",!0),a(B)?(g(),U(Ve,{key:1,color:"error",class:"text-center my-4",variant:"tonal"},{default:o(()=>[e[14]||(e[14]=u("h2",{class:"mt-4 mb-4"},"Tidak ditemukan data Tujuan Pembelajaran",-1)),u("p",null,[e[13]||(e[13]=V(" Silahkan tambah data Tujuan Pembelajaran terlebih dahulu ")),l(f,{to:{name:"referensi-tujuan-pembelajaran"}},{default:o(()=>e[12]||(e[12]=[V("disini")])),_:1})])]),_:1})):w("",!0)]),_:1}),l(J),a(m).siswa.length?(g(),U(xe,{key:0,class:"text-no-wrap"},{default:o(()=>[u("thead",null,[u("tr",null,[e[18]||(e[18]=u("th",{class:"text-center"},"No.",-1)),e[19]||(e[19]=u("th",{class:"text-center"},"Nama Peserta Didik",-1)),a(D)?(g(!0),c($,{key:0},M(a(m).tp,(t,I)=>(g(),c("th",he,[V(N(`TP ${I+1}`)+" ",1),l(je,{location:"top",activator:"parent",transition:"scale-transition"},{default:o(()=>[V(N(t.deskripsi),1)]),_:2},1024)]))),256)):(g(),c($,{key:1},[e[15]||(e[15]=u("th",{class:"text-center"},"Non Tes",-1)),e[16]||(e[16]=u("th",{class:"text-center"},"Tes",-1)),e[17]||(e[17]=u("th",{class:"text-center"},"NA Sumatif Akhir Semester",-1))],64))])]),u("tbody",null,[(g(!0),c($,null,M(a(m).siswa,(t,I)=>(g(),c("tr",null,[u("td",Ue,N(I+1),1),u("td",null,[l(H,{item:t},null,8,["item"])]),a(D)?(g(!0),c($,{key:0},M(a(m).tp,(b,Ce)=>(g(),c("td",null,[u("div",we,[l(A,{type:"number",modelValue:a(p).tp[t.anggota_rombel.anggota_rombel_id+"#"+b.tp_id],"onUpdate:modelValue":ie=>a(p).tp[t.anggota_rombel.anggota_rombel_id+"#"+b.tp_id]=ie},null,8,["modelValue","onUpdate:modelValue"])])]))),256)):(g(),c($,{key:1},[u("td",null,[l(A,{type:"number",modelValue:a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#non-tes"],"onUpdate:modelValue":[b=>a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#non-tes"]=b,b=>G(t.anggota_rombel.anggota_rombel_id,"#non-tes")]},null,8,["modelValue","onUpdate:modelValue"])]),u("td",null,[l(A,{type:"number",modelValue:a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#tes"],"onUpdate:modelValue":[b=>a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#tes"]=b,b=>G(t.anggota_rombel.anggota_rombel_id,"#tes")]},null,8,["modelValue","onUpdate:modelValue"])]),u("td",null,[l(A,{type:"number",modelValue:a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#na"],"onUpdate:modelValue":b=>a(p).sumatif[t.anggota_rombel.anggota_rombel_id+"#na"]=b,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])],64))]))),256))])]),_:1})):w("",!0),l(J),a(C)?(g(),U(Q,{key:1,class:"d-flex justify-end flex-wrap gap-3 pt-5 overflow-visible"},{default:o(()=>[l(K,{variant:"elevated",type:"submit",loading:a(j),disabled:a(j)},{default:o(()=>e[20]||(e[20]=[V(" Simpan ")])),_:1},8,["loading","disabled"])]),_:1})):w("",!0)]),_:1}),l(oe,{isDialogVisible:a(F),"onUpdate:isDialogVisible":e[7]||(e[7]=t=>x(F)?F.value=t:null),isNotifVisible:a(T),"onUpdate:isNotifVisible":e[8]||(e[8]=t=>x(T)?T.value=t:null),"confirmation-question":"Apakah Anda yakin?","confirmation-text":a(q),"confirm-color":a(h).color,"confirm-title":a(h).title,"confirm-msg":a(h).text,onClose:le},null,8,["isDialogVisible","isNotifVisible","confirmation-text","confirm-color","confirm-title","confirm-msg"])]),_:1})}}};export{ia as default};
