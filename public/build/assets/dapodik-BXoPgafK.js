import{ax as I,H as J,ay as L,Y as x,r as h,c as k,o as s,b as v,e as r,f as i,l as R,m as u,t as n,v as c,d as e,F as g,h as E,a1 as F}from"./main-DMixy-zA.js";import{S as G}from"./sweetalert2-z6gKu1nJ.js";import{u as H}from"./useApi-BFo9Fwth.js";import{c as K}from"./createUrl-BGpqzwGy.js";import{c as p,a as $}from"./mixins-CCcJzSNR.js";import{$ as w}from"./api-DuTb8U9y.js";import{V as B}from"./VCardText-COsGQpPl.js";import{V as S}from"./VAlert-BDsNoO6o.js";import{V as M}from"./VTable-dHB6tNEb.js";import{V as D}from"./VChip-BAVWtWY4.js";import{V as U}from"./VCard-BL5sBgqt.js";import"./index-9rIf2CJL.js";import"./VAvatar-Bum6FSQ0.js";import"./VImg-CVtU7sDy.js";const W={class:"text-center"},z={class:"text-center"},O={class:"text-center"},Y={class:"text-center"},Q={class:"text-center"},fe={__name:"dapodik",async setup(X){let m,V;I({title:`Ambil Data Dapodik | ${J.app.title}`});const{data:_,execute:C}=([m,V]=L(()=>H(K("/sinkronisasi",{query:{sekolah_id:p.sekolah_id,semester_id:$.semester_id,user_id:p.user_id}}))),m=await m,V(),m),T=x(()=>_.value.jam_sinkron),j=x(()=>_.value.data_sinkron),b=x(()=>_.value.error),A=l=>l.dapodik>l.erapor,f=h(!1),y=h(!1),d=h(),P=async()=>{await w(`/sinkronisasi/hitung/${p.sekolah_id}`,{method:"GET",onResponse({request:l,response:a,options:t}){let o=a._data;o.output&&(o.output.jumlah?o.output.jumlah===1&&o.output.inserted===1?d.value="Proses sinkronisasi selesai":d.value=`${o.output.table} (${o.output.inserted}/${o.output.jumlah})`:d.value=o.output.table)}})},N=async(l,a)=>{if(console.log(l),console.log(a),l&&a){y.value=!0,d.value="Menyiapkan proses sinkronisasi",f.value=!0;var t;t=setInterval(P,500),await w("/sinkronisasi/dapodik",{method:"POST",body:{email:p.email,satuan:a,tujuan:l,sekolah_id:p.sekolah_id,semester_id:$.semester_id,user_id:p.user_id},onResponse({request:o,response:q,options:Z}){q._data,f.value=!1,y.value=!1,clearInterval(t),d.value="Proses sinkronisasi selesai",G.fire({icon:"success",title:"Berhasil",text:"Sinkronisasi Dapodik Berhasil"}).then(ee=>{C()})}})}};return(l,a)=>(s(),k("div",null,[v(U,null,{default:r(()=>[u(y)?(s(),i(B,{key:0},{default:r(()=>[v(S,{color:"secondary",class:"text-center"},{default:r(()=>[n(c(u(d)),1)]),_:1})]),_:1})):R("",!0),v(B,null,{default:r(()=>[u(T)?(s(),i(S,{key:0,color:"error",class:"text-center",variant:"tonal"},{default:r(()=>a[0]||(a[0]=[e("h2",{class:"mt-4 mb-4"},"Penyesuaian Waktu Layanan Sinkronisasi Dapodik",-1),e("p",null,[n("Dikarenakan adanya proses rutin sinkronisasi data Dapodik antara Server PUSDATIN dan Server Direktorat SMK, "),e("br"),n("maka layanan sinkronisasi hanya dapat diakses antara pukul "),e("span",{class:"text-danger"},[e("b",null,"03.00 s/d 24.00 (WIB)")])],-1)])),_:1})):u(b)?(s(),i(S,{key:1,title:"Pengambilan Dapodik Gagal",type:"error",variant:"tonal"},{default:r(()=>[n(" Status Server: "+c(u(b).message),1)]),_:1})):(s(),i(M,{key:2,class:"text-no-wrap"},{default:r(()=>[a[5]||(a[5]=e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"Data"),e("th",{class:"text-center"},"Jml Dapodik"),e("th",{class:"text-center"},"Jml e-Rapor"),e("th",{class:"text-center"},"Jml Sinkron"),e("th",{class:"text-center"},"Status"),e("th",{class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(s(!0),k(g,null,E(u(j),t=>(s(),k("tr",{key:t.nama},[e("td",null,c(t.nama),1),e("td",W,c(t.dapodik),1),e("td",z,c(t.erapor),1),e("td",O,c(t.sinkron),1),e("td",Y,[t.sinkron?(s(),k(g,{key:0},[A(t)?(s(),i(D,{key:0,color:"warning"},{default:r(()=>a[1]||(a[1]=[n("Kurang")])),_:1})):(s(),i(D,{key:1,color:"success"},{default:r(()=>a[2]||(a[2]=[n("Lengkap")])),_:1}))],64)):(s(),i(D,{key:1,color:"error"},{default:r(()=>a[3]||(a[3]=[n("Belum")])),_:1}))]),e("td",Q,[t.dapodik?(s(),i(F,{key:0,loading:u(f),disabled:u(f),size:"small",color:"success",onClick:o=>N(t.server,t.aksi)},{default:r(()=>a[4]||(a[4]=[n(" Sinkronisasi ")])),_:2},1032,["loading","disabled","onClick"])):(s(),k(g,{key:1},[n(" - ")],64))])]))),128))])]),_:1}))]),_:1})]),_:1})]))}};export{fe as default};
